/**
 * Implements hook_form_FORM_ID_alter() for the custom form.
 */
function pfe_med_connect_form_pfe_med_connect_form_alter(&$form, FormStateInterface $form_state, $form_id) {
  $form['#submit'][] = 'pfe_med_connect_form_submit';
}

/**
 * Form submission handler for the custom form.
 */
function pfe_med_connect_form_submit(&$form, FormStateInterface $form_state) {
  $csv_file = $form_state->getValue('csv_file');
  
  if (!empty($csv_file[0])) {
    $file = File::load($csv_file[0]);

    if ($file instanceof Drupal\file\Entity\File) { // Check if $file is an instance of File
      $file_path = $file->getFileUri();

      // Process the CSV file.
      $data = pfe_med_connect_process_csv_file($file_path);

      if (!empty($data)) {
        // Truncate the custom_table before inserting new data.
        pfe_med_connect_truncate_table();

        // Insert the data into the custom_table.
        pfe_med_connect_insert_data($data);

        drupal_set_message('CSV data has been processed and stored in the custom_table.');
      } else {
        drupal_set_message('Failed to process the CSV file or no data found.', 'error');
      }
    } else {
      drupal_set_message('Failed to load the uploaded file.', 'error');
    }
  } else {
    drupal_set_message('No CSV file uploaded.', 'error');
  }
}
